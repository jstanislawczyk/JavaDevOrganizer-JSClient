<!DOCTYPE HTML>
<html lang="pl">
	<head>
		<meta charset="utf-8" />
		<title>Login</title>
		<meta name="description" content="Simple JavaDevOrganizer client" />
		<meta name="keywords" content="JavaDevOrganizer, client" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
			
		<link href="https://fonts.googleapis.com/css?family=Lato:400,900&amp;subset=latin-ext" rel="stylesheet">	
		<link rel="stylesheet" href="../styles/main_style.css" type="text/css" />
		<link rel="stylesheet" href="../styles/login_style.css" type="text/css" />
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>	
		<script type="text/javascript" src="scripts/cookie_control.js"></script>
		<script type="text/javascript">
			$(document).ready(function() {
				
				deleteAllCookies();
				
				$('#submit').click(function () {
				
					let email = document.querySelector("#email").value;
					let password = document.querySelector("#password").value;
					
					deleteAllCookies();
					
					$.ajax({
						url: 'http://localhost:8080/auth/checkUserData',
						method: 'POST',
						contentType: 'application/json',	
						data: JSON.stringify({ "email": email}),				
						dataType: 'json',
						crossDomain: true,
						beforeSend: function ( xhr ) {
							xhr.setRequestHeader( 'Authorization', 'Basic ' + btoa( email+':'+password) );
						},
						error: function(){
							console.log("error");
						},
						success: function( data, txtStatus, xhr ) {
							createCookie("email", email, 7);		
							createCookie("role", data.role, 7);	
							createCookie("password", password, 7);
							createCookie("firstName", data.firstName, 7);	
							createCookie("lastName", data.lastName, 7);	
							
							if(data.role==="ADMIN"){
								window.location.replace("admin.html");
							}else if(data.role === "LECTURER"){
								window.location.replace("lecturer.html");
							}else if(data.role==="STUDENT"){
								window.location.replace("student.html");
							}else{
								window.location.replace("login.html");
							}
						}
					});
				});    
			});
    </script>
		
	</head>

	<body>
		<div class="container">
			<header class="logo">
				<span class="title">JavaDevOrganizer</span>
			</header>

			<div class="form">
				<span>Logowanie</span>
				<input id="email" type="text" placeholder="login" onfocus="this.placeholder=''" onblur="this.placeholder='login'" />
				<input id="password" type="password" placeholder="hasło" onfocus="this.placeholder=''" onblur="this.placeholder='hasło'" />	
				<input type="button" id="submit" class="submit" value="Zaloguj się"/>	
			</div>
		</div>	
		
		<footer class="footer">
			<span class="footerText">Made by Jakub Stanisławczyk</span>
		</footer>	
	</body>
</html>